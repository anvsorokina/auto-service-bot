{% extends "base.html" %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞{% endblock %}
{% block page_title %}üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞{% endblock %}

{% block content %}
<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">–ó–∞—è–≤–∫–∏ —Å–µ–≥–æ–¥–Ω—è</div>
        <div class="stat-value">{{ leads_today }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">–ó–∞–ø–∏—Å–µ–π —Å–µ–≥–æ–¥–Ω—è</div>
        <div class="stat-value">{{ appointments_today }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ</div>
        <div class="stat-value" style="color: var(--warning);">{{ leads_new }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
        <div class="stat-value">{{ '%.0f' % conversion }}%</div>
    </div>
</div>

<!-- Monthly stats -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
    <div class="detail-card">
        <h3>üìã –ó–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</h3>
        <div class="detail-row">
            <span class="detail-label">–ó–∞—è–≤–∫–∏</span>
            <span class="detail-value"><strong>{{ leads_this_month }}</strong></span>
        </div>
        <div class="detail-row">
            <span class="detail-label">–í—Å–µ–≥–æ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è</span>
            <span class="detail-value">{{ leads_total }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">–ó–∞–∫—Ä—ã—Ç–æ —É—Å–ø–µ—à–Ω–æ</span>
            <span class="detail-value" style="color: var(--success);">{{ leads_won }}</span>
        </div>
    </div>

    <div class="detail-card">
        <h3>ü§ñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞</h3>
        <div class="detail-row">
            <span class="detail-label">–î–∏–∞–ª–æ–≥–æ–≤ –∑–∞ –º–µ—Å—è—Ü</span>
            <span class="detail-value"><strong>{{ conversations_month }}</strong></span>
        </div>
        <div class="detail-row">
            <span class="detail-label">–¢–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ</span>
            <span class="detail-value">{{ '{:,.0f}'.format(tokens_month) }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">–†–∞—Å—Ö–æ–¥ (–ø—Ä–∏–º–µ—Ä–Ω–æ)</span>
            <span class="detail-value">~{{ '%.0f' % estimated_cost_rub }} ‚ÇΩ</span>
        </div>
    </div>
</div>

<!-- Status breakdown -->
<div class="detail-card">
    <h3>üìä –í–æ—Ä–æ–Ω–∫–∞ –∑–∞—è–≤–æ–∫</h3>
    {% set total = leads_total if leads_total > 0 else 1 %}
    <div style="display: flex; gap: 0.5rem; margin-top: 1rem; height: 40px; border-radius: 8px; overflow: hidden;">
        {% if status_counts.get('new', 0) + status_counts.get('viewed', 0) > 0 %}
        <div style="flex: {{ status_counts.get('new', 0) + status_counts.get('viewed', 0) }}; background: #dbeafe; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">
            –ù–æ–≤—ã–µ: {{ status_counts.get('new', 0) + status_counts.get('viewed', 0) }}
        </div>
        {% endif %}
        {% if status_counts.get('contacted', 0) > 0 %}
        <div style="flex: {{ status_counts.get('contacted', 0) }}; background: #e0e7ff; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">
            –°–≤—è–∑–∞–ª–∏—Å—å: {{ status_counts.get('contacted', 0) }}
        </div>
        {% endif %}
        {% if status_counts.get('won', 0) > 0 %}
        <div style="flex: {{ status_counts.get('won', 0) }}; background: #d1fae5; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">
            –ó–∞–∫—Ä—ã—Ç–æ: {{ status_counts.get('won', 0) }}
        </div>
        {% endif %}
        {% if status_counts.get('lost', 0) > 0 %}
        <div style="flex: {{ status_counts.get('lost', 0) }}; background: #fee2e2; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">
            –ü–æ—Ç–µ—Ä—è–Ω–æ: {{ status_counts.get('lost', 0) }}
        </div>
        {% endif %}
    </div>

    {% if leads_total == 0 %}
    <div class="empty-state" style="padding: 1rem;">
        <p>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–∞—á–Ω—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∑–∞—è–≤–∫–∏.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

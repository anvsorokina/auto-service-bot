# Документ с требованиями к продукту (PRD)
## InGarage AI — AI-powered интеграция заказов для независимых автосервисов

**Версия:** 1.0
**Дата:** Март 2026
**Статус:** Production (MVP выпущен, готов к масштабированию)

---

## Оглавление

1. [Видение продукта](#видение-продукта)
2. [Проблема](#проблема)
3. [Решение](#решение)
4. [Целевая аудитория](#целевая-аудитория)
5. [Персоны пользователей](#персоны-пользователей)
6. [Истории пользователей](#истории-пользователей)
7. [Требования к функциям](#требования-к-функциям)
8. [Техническая архитектура](#техническая-архитектура)
9. [Метрики успеха](#метрики-успеха)
10. [Бизнес-модель](#бизнес-модель)
11. [План развития (Roadmap)](#план-развития-roadmap)
12. [Риски и миtigations](#риски-и-mitigations)

---

## Видение продукта

**InGarage AI** — это SaaS-платформа, которая автоматизирует процесс приёма заказов в независимых автосервисах через AI-powered чат-бота. Бот работает 24/7 в Telegram и WhatsApp, общается на русском языке, собирает информацию об автомобиле и проблеме, предоставляет смету и бронирует место в расписании.

**Видение на 3 года:**
Стать стандартным инструментом для управления входящими заказами в каждом независимом автосервисе России, Казахстана и Узбекистана. Увеличить производительность сервиса на 30% за счёт сокращения времени на обработку звонков и повышения захвата клиентов из мессенджеров.

---

## Проблема

### Ситуация на рынке

Независимые автосервисы (не дилерские центры) в России, Казахстане и Узбекистане сталкиваются с рядом проблем при управлении входящими заказами:

1. **Потеря заказов** — клиенты звонят, но никто не поднимает трубку; заказы теряются в WhatsApp-чатах
2. **Ручная обработка** — механик/администратор вручную переносит информацию из звонка в расписание
3. **Невозможность работать 24/7** — когда никого нет в офисе, заказы не принимаются
4. **Отсутствие предварительной информации** — механик не знает заранее, с какой проблемой клиент
5. **Неправильные ожидания** — клиент не получает примерную стоимость, что приводит к неудовлетворённости
6. **Конкуренция с сетями** — крупные сети имеют онлайн-сервисы, независимые остаются позади

### Боли пользователей

- **Владельцы сервисов:** потеря 15-40% потенциальных клиентов из-за недоступности, переутомление от звонков
- **Администраторы:** рутинная работа по заполнению данных отнимает 3-4 часа в день
- **Механики:** часто получают неполную информацию о проблеме, что приводит к переделкам
- **Клиенты:** долгое ожидание ответа, отсутствие информации о стоимости, невозможность записаться вечером/ночью

---

## Решение

### Концепция

InGarage AI — это чат-бот на базе Large Language Model (Claude от Anthropic), который:

1. **Встречает каждого клиента** в Telegram или WhatsApp 24/7
2. **Определяет марку/модель автомобиля** из текста на русском (включая 100+ жаргонных названий)
3. **Собирает описание проблемы** в естественном диалоге
4. **Предоставляет примерную смету** на основе ценовых правил сервиса
5. **Бронирует место** в расписании на удобное для клиента время
6. **Сохраняет лида** в систему для дальнейшей работы

### Ключевые особенности

- **Многоканальность:** одна система для Telegram и WhatsApp
- **Русский язык + жаргон:** понимает "крузак" (Land Cruiser), "приорка" (Priora), "айошка" (Pajero iO) и ещё 100+ названий
- **Smart skip:** если клиент сразу написал марку и проблему, бот пропускает лишние шаги
- **Персонализация:** владелец сервиса может настроить тон бота (дружелюбный/профессиональный/casual)
- **Админ-панель:** управление ценами, расписанием, FAQ, аналитика
- **Ручной режим:** владелец может в любой момент перехватить диалог и ответить самостоятельно
- **Multi-tenant:** один deployment служит сотням сервисов

---

## Целевая аудитория

### Географический охват
- Россия (основной фокус, ~80% от целевой базы)
- Казахстан (~10%)
- Узбекистан (~10%)

### Сегмент: Независимые автосервисы

**Критерии:**
- Численность: 2-15 человек персонала
- Годовой доход: ~100K - 500K USD
- Текущий процесс: приём заказов через Telegram, WhatsApp, звонки
- Готовность платить: $50-150/месяц за автоматизацию

**НЕ включаем:**
- Дилерские центры (свои IT-системы)
- Сетевые сервисы (уже автоматизированы)
- Прибыльные крупные сервисы (требуют enterprise-решение)

### Размер рынка (TAM)

- Россия: ~60K независимых автосервисов
- Казахстан: ~5K
- Узбекистан: ~3K
- **Итого TAM:** ~68K сервисов

**SAM (выходимый рынок):** ~15K сервисов (те, у кого есть смартфоны, интернет, готовность к цифровизации)

**SOM (целевой рынок на год 1):** 120-300 сервисов

---

## Персоны пользователей

### Персона 1: Сергей — Владелец среднего сервиса

**Профиль:**
- Возраст: 42 года
- Роль: Владелец и администратор
- Техподдержка: базовая
- Опыт: 15 лет в автосервисе, 2 года с цифровыми инструментами

**Боли:**
- Получает 20-30 звонков в день, половина отвлекают от работы
- Теряет заказы, потому что не отвечает сразу
- Не может контролировать, что администратор говорит клиентам
- Хочет понять, сколько потенциальных клиентов проходит мимо

**Цели:**
- Автоматизировать приём заказов
- Увеличить количество успешных сделок на 25%
- Получать готовые лиды с информацией об авто и проблеме
- Видеть аналитику: сколько человек начало диалог, сколько дошло до брони

**Использует:**
- Telegram (ежедневно)
- WhatsApp (ежедневно)
- Google Sheets (для расписания)

### Персона 2: Екатерина — Администратор сервиса

**Профиль:**
- Возраст: 28 лет
- Роль: Администратор, приём звонков, управление расписанием
- Техподдержка: средняя
- Опыт: 5 лет на должности

**Боли:**
- 3-4 часа в день уходит на приём звонков и заполнение данных вручную
- Часто совпадают звонки, не может ответить всем одновременно
- Нужно постоянно переспрашивать марку авто, размер двигателя
- Усталость к концу дня, качество работы падает

**Цели:**
- Сократить время на обработку заказа с 5 минут до 30 секунд
- Получить информацию в структурированном виде
- Сфокусироваться на более ценных задачах
- Меньше рутины, больше прямого общения с клиентами

**Использует:**
- WhatsApp (профессионально)
- Excel (для ведения лидов)
- Paper calendar (расписание)

### Персона 3: Иван — Частый клиент (B2C)

**Профиль:**
- Возраст: 35 лет
- Тип: Автолюбитель, обслуживает машину дважды в год
- Техподдержка: продвинутая (использует много приложений)
- Опыт: ищет проверенный сервис

**Боли:**
- Не знает, куда обратиться, заходит на авторепорталы
- Долго ждёт ответа на звонок
- Не знает примерную стоимость до приезда
- Хочет записаться вечером, когда свободен

**Цели:**
- Быстро получить примерную смету
- Забронировать время за 5 минут
- Не ездить в офис, если стоимость неприемлема
- Иметь контакт с конкретным мастером

**Использует:**
- Telegram (ежедневно)
- Яндекс.Карты, 2ГИС (поиск сервисов)

---

## Истории пользователей

### User Story 1: Владелец хочет автоматически принимать заказы
```
Как владелец автосервиса,
Я хочу, чтобы бот автоматически принимал заказы в Telegram и WhatsApp,
Чтобы я не терял клиентов, даже когда я не в офисе или занят с машинами.

Критерии приёмки:
- Бот отвечает на первое сообщение клиента в течение 2 секунд
- Диалог завершается за 3-5 минут в среднем
- Информация сохраняется в базу данных и видна в админ-панели
- Бот может работать 24/7 без сбоев
```

### User Story 2: Администратор хочет видеть структурированные лиды
```
Как администратор сервиса,
Я хочу видеть в админ-панели список всех входящих лидов с полной информацией,
Чтобы я могла быстро позвонить клиенту и подтвердить запись.

Критерии приёмки:
- Таблица лидов отображает: имя, телефон, марка авто, проблема, смета, статус
- Возможность фильтровать по статусу (горячий/теплый/холодный)
- Возможность искать по имени/номеру телефона
- Возможность просмотреть полный диалог с клиентом
```

### User Story 3: Владелец хочет настроить цены по категориям
```
Как владелец сервиса,
Я хочу в админ-панели указать стоимость услуг по категориям (замена масла, ремонт двигателя и т.д.),
Чтобы бот мог давать клиентам примерные сметы на основе моих ценовых правил.

Критерии приёмки:
- Интерфейс для добавления/редактирования категорий услуг
- Возможность указать диапазон цен (от/до)
- Возможность указать коэффициент по маркам авто (внедорожники дороже)
- Бот использует эти правила при расчёте сметы
```

### User Story 4: Клиент хочет забронировать место в расписании
```
Как клиент автосервиса,
Я хочу вечером написать боту в Telegram и сразу же забронировать время на завтра,
Чтобы не звонить и не ждать ответа.

Критерии приёмки:
- Бот показывает доступные слоты из расписания сервиса
- Клиент выбирает время одним кликом
- Запись сохраняется в расписание
- Клиент получает подтверждение с адресом, временем и контактом
```

### User Story 5: Владелец хочет видеть аналитику по воронке
```
Как владелец сервиса,
Я хочу видеть в админ-панели статистику по воронке конверсии,
Чтобы понимать, на каком этапе теряются клиенты.

Критерии приёмки:
- График: сколько диалогов начато → дошло до описания проблемы → дошло до сметы → бронирование
- Процент конверсии между каждым этапом
- Возможность сравнить данные за разные недели/месяцы
```

### User Story 6: Владелец хочет управлять персональностью бота
```
Как владелец сервиса,
Я хочу настроить тон голоса бота (дружелюбный, профессиональный, casual),
Чтобы бот общался от имени моего сервиса, а не как робот.

Критерии приёмки:
- Выбор предустановки: "Дружелюбный" / "Профессиональный" / "Casual"
- Возможность добавить кастомный FAQ
- Возможность добавить текст о промо или скидках
- Бот использует эту информацию в диалогах
```

---

## Требования к функциям

### Функции P0 (MVP, уже реализовано)

Это минимальный набор для первого релиза. Все функции P0 уже в production.

#### P0.1 Telegram-интеграция
- **Описание:** Бот работает в Telegram через aiogram 3.x
- **Требования:**
  - Долгая кодировка (long polling или webhook)
  - Обработка текстовых сообщений
  - Отправка клавиатуры для выбора вариантов
  - Безопасное хранение session state в Redis (TTL 2 часа)
- **Статус:** ✅ Production

#### P0.2 WhatsApp-интеграция (Twilio)
- **Описание:** Бот работает в WhatsApp через Twilio API
- **Требования:**
  - Webhook для входящих сообщений
  - Отправка текста и клавиатуры
  - Session state в Redis
  - Безопасное хранение Twilio credentials
- **Статус:** ✅ Production

#### P0.3 Диалоговой движок (ConversationEngine)
- **Описание:** LLM-powered диалог на базе Claude API
- **Требования:**
  - Шаги диалога: приветствие → марка авто → проблема → смета → бронь → контакты
  - Естественная обработка текста (не шаблоны)
  - Понимание 100+ названий авто (жаргон): "крузак", "приорка", "айошка" и т.д.
  - Skip-шаги: если клиент написал "мне нужна замена масла на приорке", пропустить лишние шаги
  - Русский язык по умолчанию
  - Обработка ошибок (если бот не понял, переспросить вежливо)
- **Статус:** ✅ Production

#### P0.4 Управление ценами
- **Описание:** Владелец настраивает ценовые правила в админ-панели
- **Требования:**
  - Таблица категорий услуг (замена масла, диагностика, ремонт двигателя и т.д.)
  - Для каждой категории: диапазон цен (от/до)
  - Коэффициент сложности по маркам авто (внедорожник +30%, седан базовая цена)
  - Бот использует эти правила для расчёта сметы
  - REST API для CRUD операций
- **Статус:** ✅ Production

#### P0.5 Управление расписанием
- **Описание:** Недельный календарь доступных слотов для записи
- **Требования:**
  - Таблица рабочих часов (пн-пт 08:00-18:00, сб 10:00-14:00)
  - Длительность слота по умолчанию: 1 час
  - Максимум записей в один слот: 3
  - REST API для просмотра свободных слотов
  - Бот показывает доступные слоты клиенту
- **Статус:** ✅ Production

#### P0.6 База лидов
- **Описание:** Сохранение всех входящих диалогов как лидов
- **Требования:**
  - Таблица лидов: имя, телефон, марка авто, проблема, смета, статус (new/contacted/booked/lost), timestamp
  - Полный история диалога (можно просмотреть полный чат)
  - Привязка к shop_id (для multi-tenant)
  - Статус "горячий/теплый/холодный" рассчитывается автоматически
- **Статус:** ✅ Production

#### P0.7 Админ-панель (интерфейс)
- **Описание:** Простой веб-интерфейс для управления сервисом
- **Требования:**
  - Таблица лидов с фильтрацией и поиском
  - Просмотр деталей лида (полный диалог)
  - Управление ценами
  - Управление расписанием
  - Управление основными настройками (название, адрес, рабочие часы)
  - Stack: Jinja2 + HTMX + Pico CSS
- **Статус:** ✅ Production

#### P0.8 Аутентификация владельца
- **Описание:** Вход в админ-панель для владельца сервиса
- **Требования:**
  - Telegram Login Widget (стандартный способ для российских пользователей)
  - Привязка admin_user к shop_id
  - Session cookies с TTL 7 дней
  - Защита от CSRF
- **Статус:** ✅ Production

#### P0.9 API для интеграций
- **Описание:** REST API для будущих интеграций
- **Требования:**
  - Endpoints для CRUD лидов, цен, расписания
  - Аутентификация по API key
  - Документация (OpenAPI/Swagger)
  - Rate limiting (100 req/min per shop)
- **Статус:** ✅ Production

---

### Функции P1 (First Growth Sprint, 1-2 месяца)

Высокоприоритетные функции для увеличения retention и adoption.

#### P1.1 Расширенная аналитика
- **Описание:** Dashboard с метриками по воронке конверсии
- **Требования:**
  - График: started → problem_described → estimate_shown → booking_completed
  - % конверсии между каждым этапом
  - Сравнение по периодам (неделя, месяц)
  - Топ-3 проблемы (что чаще всего спрашивают клиенты)
  - Топ-3 марок авто
  - Время ответа бота, среднее время диалога
  - Export в CSV/PDF
- **Приоритет:** Высокий (собственники хотят метрики для ROI)

#### P1.2 Кастомизация голоса бота
- **Описание:** Предустановки тона общения
- **Требования:**
  - 3 режима: "Дружелюбный", "Профессиональный", "Casual"
  - Возможность добавить кастомный FAQ (20-50 часто задаваемых вопросов)
  - Поле для текста о промо/скидках
  - Поле для описания специализации (например, "Профессионально работаем с внедорожниками")
  - Бот использует эту информацию в диалогах при ответах на кастомные вопросы
- **Приоритет:** Высокий (улучшает conversion rate)

#### P1.3 Уведомления собственнику
- **Описание:** Push-notifications при новом лиде
- **Требования:**
  - Отправка уведомления в Telegram при новой записи
  - Содержимое: имя, марка авто, проблема, смета
  - Возможность отключить в настройках
  - Батчинг: 1 уведомление в час максимум (чтобы не спамить)
- **Приоритет:** Средний

#### P1.4 Ручной режим (takeover)
- **Описание:** Администратор может перехватить диалог и ответить лично
- **Требования:**
  - Команда /takeover в админ-панели при просмотре лида
  - Переключение на manual mode
  - Все следующие сообщения клиента идут напрямую в Telegram администратора
  - История остаётся в системе
  - Возможность вернуться на автоматический режим
- **Приоритет:** Средний

#### P1.5 Экспорт лидов
- **Описание:** Выгрузка лидов в CRM или электронную таблицу
- **Требования:**
  - Export в CSV (имя, телефон, марка, проблема, статус, время)
  - Фильтрация перед экспортом (например, все за последний месяц)
  - Export в 1С (если есть техническая возможность)
  - Запланированный экспорт (ежедневно/еженедельно)
- **Приоритет:** Средний

---

### Функции P2 (Future Roadmap, 3-6 месяцев)

Дополнительные функции для дифференциации и growth.

#### P2.1 Интеграция с каталогами запчастей
- **Описание:** Бот рекомендует оригинальные запчасти на основе проблемы
- **Требования:**
  - API интеграция с Exist.ru или Avtodrugov.ru (российские каталоги запчастей)
  - Когда клиент описывает проблему, бот ищет нужные запчасти
  - Вывод рекомендаций с ценой (опционально)
- **Приоритет:** Низкий (nice-to-have)

#### P2.2 Многоязычность (Казахский, Узбекский)
- **Описание:** Поддержка языков для соседних стран
- **Требования:**
  - Параметр language в настройках сервиса
  - Список авто на казахском и узбекском
  - Интерфейс админ-панели на трёх языках
  - Требует расширения промп-инженерии для каждого языка
- **Приоритет:** Низкий (первый фокус — Россия)

#### P2.3 Интеграция платежей
- **Описание:** Клиент платит часть стоимости через бота и получает скидку
- **Требования:**
  - Интеграция с Yandex.Kassa или Stripe
  - Бот отправляет ссылку на оплату
  - Автоматическое создание счёта
  - Статус в лиде: "оплачено" / "частично оплачено"
- **Приоритет:** Низкий (зависит от бизнес-модели)

#### P2.4 Рейтинги и отзывы
- **Описание:** После завершения услуги клиент оставляет отзыв
- **Требования:**
  - Бот отправляет запрос на отзыв через 3 дня после записи
  - Оценка 1-5 звёзд, текстовый комментарий
  - Отзывы видны в публичном профиле сервиса
  - Интеграция с Яндекс.Картами и 2ГИС (если возможно)
- **Приоритет:** Низкий

#### P2.5 Мобильное приложение для владельца
- **Описание:** iOS/Android app для управления сервисом в движении
- **Требования:**
  - Push-notifications при новых лидах
  - Быстрый просмотр лидов, расписания, аналитики
  - Ручной takeover режим
  - Stack: React Native или Flutter
- **Приоритет:** Низкий (сначала веб-версия должна быть совершенной)

---

## Техническая архитектура

### Существующий стек (Production)

```
Backend:
├── Python 3.12 + FastAPI (REST API)
├── SQLAlchemy async (ORM, миграции)
├── PostgreSQL (Supabase) — основная БД
├── Redis (Upstash) — session state, rate limiting
├── Anthropic Claude API — LLM для диалогов
├── aiogram 3.x — Telegram bot integration
├── Twilio API — WhatsApp integration
└── Deployment: Railway + Docker

Frontend (Admin Panel):
├── Jinja2 — шаблоны
├── HTMX — динамические обновления без refresh
├── Pico CSS — минималистичный UI
└── Fetch API — запросы к backend

GitHub: https://github.com/anvsorokina/auto-service-bot
```

### Архитектурная диаграмма

```
┌─────────────────────────────────────────────────────┐
│                    Telegram Users                    │
└──────────────┬──────────────────────────────────────┘
               │
        ┌──────▼──────┐
        │ Telegram Bot │ (aiogram 3.x)
        │   Webhook   │
        └──────┬──────┘
               │
        ┌──────▼──────────────────────────┐
        │    FastAPI Server (Railway)      │
        │  ├─ /api/telegram/webhook        │
        │  ├─ /api/whatsapp/webhook        │
        │  ├─ /api/leads (CRUD)            │
        │  ├─ /api/pricing (CRUD)          │
        │  ├─ /api/schedule (CRUD)         │
        │  ├─ /admin (Jinja2 + HTMX)       │
        │  └─ /api/analytics               │
        └──────┬──────────────────────────┘
               │
       ┌───────┴────────┬─────────────┬──────────────┐
       │                │             │              │
    ┌──▼──────┐   ┌────▼─────┐  ┌───▼────┐  ┌─────▼──┐
    │PostgreSQL   │   Redis    │  │ Claude │  │ Twilio │
    │ (Supabase)  │  (Upstash) │  │ API    │  │ API    │
    └──────────┘   └────────────┘  └────────┘  └────────┘
```

### Ключевые компоненты

#### 1. ConversationEngine
- **Задача:** Управление диалогом через LLM
- **Работает:** Через Claude API с промптом на русском
- **Session State:** Хранится в Redis (shop_id:user_id:step)
- **Шаги:** greeting → car_identification → problem_collection → estimate → booking → confirmation

#### 2. CarIdentifier
- **Задача:** Распознавание марки/модели из текста
- **Данные:** 100+ жаргонных названий (крузак, приорка, айошка и т.д.)
- **Реализация:** Таблица в БД или в промпте Claude

#### 3. PricingEngine
- **Задача:** Расчёт сметы на основе ценовых правил
- **Входные данные:** марка авто, категория услуги
- **Выходные данные:** диапазон цен (от/до)
- **Хранение:** Таблица pricing_rules в PostgreSQL

#### 4. ScheduleManager
- **Задача:** Управление расписанием и доступными слотами
- **Логика:** Рабочие часы + максимум записей в один слот
- **API:** GET /api/schedule/available-slots?date=2026-03-15

#### 5. LeadManager
- **Задача:** Сохранение всех диалогов как лидов
- **Таблица:** leads (id, shop_id, phone, car_brand, problem, estimate, status, created_at, conversation_history)
- **Статусы:** new → contacted → booked → completed/lost

#### 6. AdminPanel (Jinja2 + HTMX)
- **Роуты:** /admin/login, /admin/dashboard, /admin/leads, /admin/pricing, /admin/schedule, /admin/settings
- **Аутентификация:** Telegram Login Widget
- **Обновления:** HTMX для изменения данных без полного refresh

### Database Schema (PostgreSQL)

```sql
-- Таблица сервисов (multi-tenant)
CREATE TABLE shops (
    id UUID PRIMARY KEY,
    telegram_id BIGINT UNIQUE,
    name VARCHAR(255),
    address VARCHAR(255),
    phone VARCHAR(20),
    working_hours JSONB,
    bot_personality VARCHAR(50), -- friendly/professional/casual
    created_at TIMESTAMP DEFAULT NOW()
);

-- Таблица лидов
CREATE TABLE leads (
    id UUID PRIMARY KEY,
    shop_id UUID REFERENCES shops(id),
    phone VARCHAR(20),
    name VARCHAR(100),
    car_brand VARCHAR(100),
    car_model VARCHAR(100),
    problem TEXT,
    estimate_min DECIMAL(10, 2),
    estimate_max DECIMAL(10, 2),
    status VARCHAR(50), -- new/contacted/booked/completed/lost
    preferred_time TIMESTAMP,
    conversation_history JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Таблица ценовых правил
CREATE TABLE pricing_rules (
    id UUID PRIMARY KEY,
    shop_id UUID REFERENCES shops(id),
    service_category VARCHAR(100),
    price_min DECIMAL(10, 2),
    price_max DECIMAL(10, 2),
    car_brand_coefficient DECIMAL(3, 2), -- для дорогих авто
    created_at TIMESTAMP DEFAULT NOW()
);

-- Таблица расписания
CREATE TABLE schedule_slots (
    id UUID PRIMARY KEY,
    shop_id UUID REFERENCES shops(id),
    date DATE,
    start_time TIME,
    end_time TIME,
    max_bookings INT DEFAULT 3,
    current_bookings INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Таблица админов
CREATE TABLE admin_users (
    id UUID PRIMARY KEY,
    shop_id UUID REFERENCES shops(id),
    telegram_id BIGINT,
    username VARCHAR(100),
    created_at TIMESTAMP DEFAULT NOW()
);
```

### Redis Schema

```
Key pattern: {shop_id}:{user_id}:session
Value: JSON object
{
  "step": "car_identification",
  "car_brand": null,
  "problem": null,
  "preferred_time": null,
  "created_at": "2026-03-01T10:00:00Z"
}
TTL: 2 hours
```

### Окружение (Environment Variables)

```bash
# Database
DATABASE_URL=postgresql://user:pass@host/db

# Redis
REDIS_URL=redis://host:port

# Telegram
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrstUVWxyz

# Twilio
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxx
TWILIO_PHONE_NUMBER=+1234567890

# Anthropic
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxx

# Deployment
RAILWAY_ENVIRONMENT=production
RAILWAY_STATIC_URL=https://auto-service-bot-production.up.railway.app
```

### API Endpoints (основные)

```
POST   /api/telegram/webhook          — обработка сообщений Telegram
POST   /api/whatsapp/webhook          — обработка сообщений WhatsApp
GET    /api/leads                     — список лидов (с фильтрацией)
POST   /api/leads                     — создание лида (из бота)
GET    /api/leads/{id}                — деталь лида + полный диалог
PATCH  /api/leads/{id}                — обновление статуса
GET    /api/pricing                   — ценовые правила
POST   /api/pricing                   — создание правила
PATCH  /api/pricing/{id}              — обновление правила
DELETE /api/pricing/{id}              — удаление правила
GET    /api/schedule/available-slots  — доступные слоты (query: date)
POST   /api/schedule/book             — бронирование слота
GET    /api/analytics/funnel          — метрики воронки
GET    /api/settings                  — настройки сервиса
PATCH  /api/settings                  — обновление настроек
GET    /admin/login                   — форма входа (Telegram Widget)
POST   /admin/auth                    — проверка Telegram Widget
GET    /admin/dashboard               — главная панель (требует auth)
```

---

## Метрики успеха

### Ключевые метрики (North Star Metrics)

#### 1. Retention Rate (Месячная)
- **Определение:** % сервисов, которые были активны в месяц M и остались активны в месяц M+1
- **Целевое значение:** >80% за 3 месяца
- **Что считается активным:** ≥1 диалога с клиентом в месяц

#### 2. Average Revenue Per User (ARPU)
- **Определение:** Средний MRR на один активный сервис
- **Текущее значение:** TBD (зависит от ценообразования)
- **Целевое значение:** $89/месяц
- **Фокус:** Увеличить ARPU через add-ons и premium features

#### 3. Customer Acquisition Cost (CAC)
- **Определение:** Сумма затрат на маркетинг / количество приобретённых сервисов
- **Целевое значение:** <$100 per shop
- **Как снизить:** Referral programs, content marketing, partnerships

#### 4. Lifetime Value (LTV)
- **Определение:** Average ARPU × Average Lifetime (месяцы) × Gross Margin
- **Целевое значение:** $1,000+ (11+ месяцев при ARPU $89)
- **Требование:** LTV/CAC > 3x

### Product Metrics

#### 5. Conversation Completion Rate
- **Определение:** % диалогов, которые дошли до стадии бронирования (все 5 шагов завершены)
- **Целевое значение:** >75% за 3 месяца
- **Текущее значение:** TBD
- **Улучшение:** Оптимизация промпта, skip-steps logic

#### 6. Booking Confirmation Rate
- **Определение:** % броней, которые были подтверждены клиентом (телефон вводил + время выбрал)
- **Целевое значение:** >85%
- **Метрика качества:** Если <85%, нужна переработка UX бота

#### 7. Time to First Response
- **Определение:** Среднее время от первого сообщения клиента до первого сообщения бота
- **Целевое значение:** <2 секунд
- **Текущее значение:** ~1 сек (хороший результат)

#### 8. Average Conversation Duration
- **Определение:** Среднее время от первого до последнего сообщения в диалоге
- **Целевое значение:** <5 минут
- **Коррелирует с:** UX сложностью, скоростью бота

### Business Metrics

#### 9. Monthly Recurring Revenue (MRR)
- **Определение:** Сумма всех активных подписок в конце месяца
- **Целевое значение на год 1:** $10,000/месяц (120 сервисов × $89)
- **Целевое значение на год 2:** $50,000/месяц (500+ сервисов)

#### 10. Churn Rate (Monthly)
- **Определение:** (Сервисы, отписанные в месяц M) / (Активные сервисы в начале месяца M)
- **Целевое значение:** <5% (т.е. 95%+ retention)
- **Пороговое значение:** >10% означает, что нужно разбираться в причинах

#### 11. Net Promoter Score (NPS)
- **Определение:** Результат опроса: "Насколько вы готовы рекомендовать InGarage AI своим коллегам?"
- **Целевое значение:** >40 (good SaaS)
- **Сейчас:** TBD (нужно начать опрашивать)

#### 12. Customer Satisfaction (CSAT)
- **Определение:** % ответивших на вопрос "Насколько вы удовлетворены?" с оценкой 4-5 из 5
- **Целевое значение:** >80%

### Usage Metrics

#### 13. Conversations Per Shop Per Month
- **Определение:** Среднее количество диалогов, инициированных клиентами
- **Целевой диапазон:** 20-100 диалогов в месяц на средний сервис
- **Индикатор:** Если <10, значит сервис не продвигает бота в своём чате

#### 14. Admin Panel Logins Per Month
- **Определение:** Как часто владельцы заходят в админ-панель
- **Целевое значение:** >5 логинов в месяц (в среднем)
- **Интерпретация:** Низкие логины = низкая вовлечённость

#### 15. Feature Adoption (%)
- **Определение:** % сервисов, которые использовали каждую функцию
  - Просмотр лидов: >95%
  - Управление ценами: >70%
  - Просмотр расписания: >60%
  - Ручной takeover: >30%

### Качество & Надёжность

#### 16. Bot Uptime
- **Определение:** % времени, когда бот был доступен (не было ошибок)
- **Целевое значение:** >99.5% (SLA)
- **Мониторинг:** Uptime checks каждые 5 минут

#### 17. Error Rate
- **Определение:** % запросов, которые завершились с ошибкой (5xx status)
- **Целевое значение:** <0.1%
- **Мониторинг:** Sentry или аналогичный сервис

#### 18. API Response Time (p95)
- **Определение:** 95-й процентиль времени ответа API
- **Целевое значение:** <500ms
- **Мониторинг:** CloudWatch или похожее

---

## Бизнес-модель

### Модель ценообразования (SaaS)

#### Вариант 1: Flat-rate подписка (текущий)
```
Free Tier:
- До 50 диалогов в месяц
- Основные функции (приём заказов, расписание)
- Реклама InGarage в сообщениях бота

Pro ($89/месяц):
- До 500 диалогов в месяц
- Без ограничений по функциям
- Без рекламы
- Базовая аналитика
- Email support

Enterprise (custom):
- Неограниченные диалоги
- Приоритетная поддержка
- API интеграции
- Белый лейбл
- Dedicated account manager
```

#### Вариант 2: Usage-based (рассмотреть в будущем)
```
$29/месяц базовая подписка
+ $0.10 за каждый завершённый диалог (дошёл до брони)

Pro-rata billing, выставляется в конце месяца
```

### Доход на год 1

```
Целевой результат: $10K MRR → $120K ARR

Прогноз по месяцам:
- Месяц 1: 5 сервисов × $89 = $445
- Месяц 3: 20 сервисов = $1,780
- Месяц 6: 60 сервисов = $5,340
- Месяц 12: 120 сервисов = $10,680

Допущения:
- 20% monthly growth на первые 3 месяца
- 10% monthly growth месяцы 4-12
- Churn rate: 5% в месяц
- Free → Pro conversion: 15%
```

### Go-to-Market стратегия (Год 1)

#### Этап 1: Product-led Growth (Месяцы 1-3)
- Бесплатный tier с 50 диалогами в месяц
- Onboarding через Telegram (пошаговый гайд)
- Зарастание выше лимита триггерит предложение Pro
- Нулевой маркетинг бюджет (органический рост)

#### Этап 2: Viral & Community (Месяцы 4-6)
- Программа referral: +$10 credit за каждого приведённого сервиса
- Партнёрства с поставщиками автозапчастей (cross-promotion)
- Группы в Telegram для пользователей (community building)
- Первые case studies из успешных сервисов

#### Этап 3: Paid Acquisition (Месяцы 7-12)
- Реклама в Яндекс.Метрике (таргет: "автосервис чат-бот")
- Рекламные посты в автолюбительских сообществах ВКонтакте
- Партнёрства с агрегаторами (2ГИС, Яндекс.Карты)
- Холодный outreach к топ-200 сервисам (LinkedIn, email)

### Каналы продаж

1. **Самообслуживание (80% доход)**
   - Клиент заходит на сайт, регистрируется в Telegram
   - Пробует Free tier 50 диалогов
   - Переводит в Pro при необходимости

2. **Прямые продажи (15% доход)**
   - Торговый представитель звонит владельцам сервисов
   - Демонстрирует bot в live demo
   - Подписывает Enterprise контракты

3. **Партнёрства (5% доход)**
   - Интеграции с CRM системами (если будут)
   - Белый лейбл для крупных сетей

---

## План развития (Roadmap)

### Q1 2026 (Март-Май): Stabilization & Early Adoption

**Цель:** 50 активных сервисов, 99.5% uptime, NPS > 30

```
Week 1-2:
- Мониторинг production (Sentry, uptime checks)
- Начать опросы NPS и CSAT
- Сбор первых 20 отзывов от пользователей

Week 3-4:
- Фикс багов на основе feedback
- Оптимизация Claude промпта (улучшить skip-steps логику)
- Готовить case study первого успешного сервиса

Week 5-8:
- Запуск Free tier (50 диалогов)
- Рефералоальная программа (+$10 credit)
- Email-рассылка для early adopters
- Документация и видео-гайды
```

### Q2 2026 (Июнь-Август): Growth & Feature Expansion

**Цель:** 150+ активных сервисов, $5K MRR, $20K+ ARR projection

**P1 функции:**
- [P1.1] Расширенная аналитика (funnel, конверсия)
- [P1.2] Кастомизация голоса бота
- [P1.3] Уведомления собственнику в Telegram
- [P1.4] Ручной takeover mode

**Дополнительно:**
- Партнёрства с поставщиками запчастей
- Первые интеграции в 2ГИС и Яндекс.Карты

### Q3 2026 (Сентябрь-Ноябрь): Scale & Monetization

**Цель:** 300+ активных сервисов, $10K MRR, платные каналы работают

**Инициативы:**
- Запуск платной рекламы (Яндекс, ВКонтакте)
- Холодный outreach к топ-500 сервисам
- Enterprise package для сетевых сервисов
- Начало разработки mobile app

**Функции:**
- [P1.5] Экспорт лидов в CRM
- [P2.1] Интеграция каталогов запчастей (MVP)

### Q4 2026 (Декабрь-Февраль): Expansion & Optimization

**Цель:** 500+ активных сервисов, $15K MRR, подготовка к году 2

**Инициативы:**
- Расширение на Казахстан (перевод интерфейса, локализация)
- Расширение на Узбекистан (аналогично)
- Интеграция платежей (опционально)
- Бета-тестирование мобильного приложения

---

## Риски и Mitigations

### Критические риски

#### Риск 1: Низкое качество LLM диалогов
**Вероятность:** Средняя | **Воздействие:** Высокое

**Описание:** Claude может неправильно распознавать марки авто, генерировать невразумные сметы, или выдавать странные сообщения на русском.

**Mitigation:**
- Постоянный мониторинг качества диалогов (sample 10% conversations)
- A/B тестирование разных промптов
- Rapid feedback loop от пользователей (форма "бот ошибся")
- Fallback на more conservative prompt если качество падает

#### Риск 2: Чёрный лебедь в Claude API (сбой, недоступность)
**Вероятность:** Низкая | **Воздействие:** Критическое

**Описание:** Anthropic отключил API, изменил ценообразование, или Claude стал генерировать неполные ответы.

**Mitigation:**
- Кэширование часто используемых ответов (для типовых вопросов)
- Fallback на более простые template-based ответы при ошибке API
- Мониторинг в Sentry с алертами при >5% error rate
- Контракт с поддержкой Anthropic (если будет)
- Изучение альтернатив (GPT-4, Llama, Claude 4, etc)

#### Риск 3: Отток пользователей (высокий churn)
**Вероятность:** Средняя | **Воздействие:** Высокое

**Описание:** Сервисы отписываются потому что не видят ROI или не нашли практического применения.

**Mitigation:**
- Ежемесячные check-in звонки с сервисами (собирать feedback)
- Personalized onboarding для каждого нового сервиса
- Простая интеграция: минимум 15 минут до первого диалога
- Win-back кампании для отписавшихся (скидка 30% на месяц)
- Success metrics в админ-панели (показывать сколько привёл клиентов)

#### Риск 4: Конкурентное давление (Google, Yandex, крупные CRM запустят своё)
**Вероятность:** Средняя | **Воздействие:** Высокое

**Описание:** Крупные игроки скопируют идею и раздавят нас ценой / распределением.

**Mitigation:**
- Фокусировка на специфический юс-кейс (автосервисы, не генеральные чат-боты)
- Накопление сетевых эффектов (сообщество, отзывы, экосистема)
- Глубокая интеграция с операционными процессами сервиса (расписание, цены)
- Быстрая экспансия на Казахстан и Узбекистан
- Build-in features конкурентам будет дорого (русский + жаргон + авто-дизайн)

### Операционные риски

#### Риск 5: Масштабирование PostgreSQL и Redis
**Вероятность:** Низкая | **Воздействие:** Высокое

**Описание:** При 500+ сервисах и миллионах диалогов в месяц БД может стать узким местом.

**Mitigation:**
- Использование managed сервисов (Supabase + Upstash) с auto-scaling
- Партиционирование по shop_id
- Кэширование часто используемых данных в Redis
- Мониторинг query performance
- Query optimization и индексирование
- Готовность к sharding если будет нужно

#### Риск 6: Зависимость от Railway (хостинг)
**Вероятность:** Низкая | **Воздействие:** Среднее

**Описание:** Если Railway упадёт, весь сервис будет недоступен.

**Mitigation:**
- Docker контейнеры (легко перенести на другой хост)
- Документирование процесса миграции
- Инфраструктура as code (если будет нужна)
- Мониторинг uptime (Pingdom, UptimeRobot)
- Запасной план переноса на Google Cloud / AWS

#### Риск 7: Утечка данных (Telegram ID, номера телефонов)
**Вероятность:** Низкая | **Воздействие:** Критическое

**Описание:** Хакер получит доступ к базе и украдёт номера телефонов клиентов сервисов.

**Mitigation:**
- Шифрование чувствительных данных (phone numbers) в БД
- SSL/TLS для всех connections
- Regular security audits
- Соответствие GDPR (удаление данных по запросу)
- Инструмент 2FA для аккаунтов администраторов
- Логирование и мониторинг доступа к данным

---

## Приложения

### A. Жаргонные названия авто (примеры)

```
Японские:
- крузак → Toyota Land Cruiser 100/200
- приорка → Lada Priora
- айошка → Mitsubishi Pajero iO
- ниссан → Nissan (любой)
- мазда → Mazda (любой)
- тойота → Toyota (любой)

Русские:
- вазик → Lada (любой)
- волга → GAZ Volga
- мос-квич → Moskvitch
- чайка → GAZ Chaika

Иностранные:
- фольксваген → Volkswagen
- мерседес → Mercedes-Benz
- бмв → BMW
- ауди → Audi
- вольво → Volvo
- шкода → Skoda
- хюндай → Hyundai
- киа → Kia
- ФАВ → FAW
- ДЭУ → Daewoo
- шевроле → Chevrolet
```

### B. Примеры диалогов (тестовые сценарии)

**Сценарий 1: Простой диалог**
```
Клиент: Привет, нужна замена масла на приорке
Бот: Привет! Спасибо, что написали. Я вижу, что вам нужна замена масла на Lada Priora.
     Это вам срочно? Когда вам удобнее приехать?
Клиент: Завтра в 10 утра
Бот: Отлично! Примерная стоимость замены масла на Priora: 1,500-2,000 рублей.
     У нас есть свободное место завтра в 10:00. Ваше имя и номер телефона?
Клиент: Вася, +79991234567
Бот: Спасибо, Вася! Запись подтверждена на 01.03.2026 в 10:00.
     Адрес: ул. Ленина, 45. До встречи!
```

**Сценарий 2: Сложный диалог с уточнениями**
```
Клиент: Крузак не заводится
Бот: Здравствуйте! Я вижу, что у вас проблема с запуском Toyota Land Cruiser.
     Скажите, пожалуйста, когда это началось? Машина вообще не реагирует на ключ?
Клиент: Вчера получил, с утра не заводится, аккумулятор вроде в порядке
Бот: Понятно. Могут быть проблемы с генератором, стартером или зажиганием.
     Примерная диагностика: 1,500-3,000 рублей (зависит от результата).
     Когда вам удобнее приехать? Рекомендую приехать завтра.
Клиент: А если это генератор? Сколько стоит замена?
Бот: Замена генератора на Land Cruiser: 5,000-8,000 рублей (детали + работа).
     Но давайте сначала диагностируем. Когда приехать?
Клиент: Завтра в 14:30
Бот: [сохраняет в систему, бронирует место]
```

### C. Метрики для отслеживания (Dashboard)

```
Главный экран админ-панели (Dashboard):

┌─────────────────────────────────────────────────┐
│  InGarage AI — Dashboard для "Сервис Иванова"  │
├─────────────────────────────────────────────────┤
│                                                 │
│  Активных диалогов этот месяц: 47              │
│  Из них дошло до брони: 38 (80.9%)             │
│  Новых лидов: 38                                │
│  Потеряно на этапе: 9 (19.1%)                  │
│                                                 │
│  ┌─────────────────────────────────────────┐  │
│  │ Воронка конверсии                       │  │
│  │                                         │  │
│  │ Начали диалог      ████████ 47          │  │
│  │ Описали проблему   ███████  43          │  │
│  │ Получили смету     ██████   40          │  │
│  │ Забронировали      █████    38          │  │
│  │                                         │  │
│  │ Funnel drop: 19%                        │  │
│  └─────────────────────────────────────────┘  │
│                                                 │
│  Последние лиды:                               │
│  • Сергей, +79991111111 - Toyota Camry (01.03 14:30)
│  • Мария, +79992222222 - Mitsubishi (02.03 10:00)
│  • Иван, +79993333333 - Lada Priora (02.03 15:00)
│                                                 │
└─────────────────────────────────────────────────┘
```

---

## Заключение

InGarage AI решает реальную проблему независимых автосервисов: потерю заказов из-за недоступности, ручную обработку и отсутствие информации о цене.

**Основная ценность:**
- Работает 24/7, берёт весь приём на себя
- Понимает русский жаргон и марки авто
- Интегрирован с расписанием и ценами
- Снижает нагрузку на администратора на 80%
- Увеличивает завершённость заказов на 25-40%

**На год 1 нацелены на:**
- 120+ активных сервисов
- $10K MRR ($120K ARR)
- >80% retention rate
- >75% completion rate в диалогах

**Конкурентное преимущество:**
- Специализация на автосервисах (не генеральный чат-бот)
- Глубокое понимание операционных процессов
- Russian-first approach (жаргон, языковые нюансы)
- Product-led growth и viral mechanics

---

**Версия документа:** 1.0
**Последнее обновление:** Март 2026
**Автор:** Product Team
**Статус:** Одобрено для реализации
